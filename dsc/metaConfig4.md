# Локальный диспетчер конфигураций для настройки требуемого состояния Windows PowerShell 4.0 (LCM)

>Область применения: Windows PowerShell 4.0, Windows PowerShell 5.0

Локальный диспетчер конфигураций — это механизм настройки требуемого состояния (DSC) Windows PowerShell. Он работает на всех целевых узлах и отвечает за вызов ресурсов конфигураций, включенных в сценарий конфигурации DSC. В этом разделе перечислены свойства локального диспетчера конфигураций и описано, как изменять параметры локального диспетчера конфигурации на целевом узле.

## Свойства локального диспетчера конфигураций
Ниже перечислены свойства локального диспетчера конфигураций, которые можно задавать или извлекать.
 
* **AllowModuleOverwrite**: определяет, могут ли новые конфигурации, загружаемые с сервера конфигураций, перезаписывать старые конфигурации, уже находящиеся на целевом узле. Возможные значения — True и False.
* **CertificateID**: GUID сертификата, защищающего учетные данные для доступа к конфигурации. Дополнительные сведения см. в статье [Защита учетных данных в службе настройки требуемого состояния Windows PowerShell](http://blogs.msdn.com/b/powershell/archive/2014/01/31/want-to-secure-credentials-in-windows-powershell-desired-state-configuration.aspx).
* **ConfigurationID**: GUID, используемый для получения определенного файла конфигурации с сервера, заданного в качестве опрашивающего. Этот GUID обеспечивает доступ к нужному файлу конфигурации.
* **ConfigurationMode**: указывает, как именно локальный диспетчер конфигураций применяет конфигурацию к целевым узлам. Возможны следующие значения:
    - **ApplyOnly**: если выбран этот параметр, DSC применяет конфигурацию и не выполняет никаких действий, пока не будет обнаружена новая конфигурация — это произойдет, если вы принудительно отправите новую конфигурацию на целевой узел или настроите опрашивающий сервер и DSC увидит новую конфигурацию про проверке опрашивающего сервера. При расхождениях с конфигурацией на целевом узле никакие действия не предпринимаются.
    - **ApplyAndMonitor**: если выбран этот параметр (он используется по умолчанию), DSC применяет все новые конфигурации, как отправленные вами на целевой узел, так и обнаруженные на опрашивающем сервере. Затем, если конфигурация на целевом узле отличается от файла конфигурации, DSC сообщает о расхождении в журналах. Дополнительные сведения о ведении журналов DSC см. в статье [Использование журналов событий для диагностики ошибок в службе настройки требуемого состояния](http://blogs.msdn.com/b/powershell/archive/2014/01/03/using-event-logs-to-diagnose-errors-in-desired-state-configuration.aspx).
    - **ApplyAndAutoCorrect**: если выбран этот параметр, DSC применяет все новые конфигурации, как отправленные вами на целевой узел, так и обнаруженные на опрашивающем сервере. Затем, если конфигурация на целевом узле отличается от файла конфигурации, DSC сообщает о расхождении в журналах и пытается привести конфигурацию на целевом узле в соответствие с файлом конфигурации.
* **ConfigurationModeFrequencyMins**: указывает, с какой частотой (в минутах) фоновое приложение DSC будет пытаться применить текущую конфигурацию на целевом узле. Значение по умолчанию — 15. Это свойство может быть задано в сочетании со свойством RefreshMode. Если свойство RefreshMode имеет значение PULL, целевой узел подключается к серверу конфигураций с интервалом, заданным свойством RefreshFrequencyMins, и загружает текущую конфигурацию. Независимо от значения свойства RefreshMode модуль обеспечения согласованности применяет последнюю конфигурацию, загруженную на целевой узел, с интервалом, заданным свойством ConfigurationModeFrequencyMins. Значение свойства RefreshFrequencyMins должно быть выражено целым числом, кратным значению свойства ConfigurationModeFrequencyMins.
* **Credential**: указывает учетные данные (как при использовании командлета Get-Credential), необходимые для доступа к удаленным ресурсам, например для подключения к серверу конфигураций.
* **DownloadManagerCustomData**: представляет массив, который содержит пользовательские данные, относящиеся к диспетчеру загрузки.
* **DownloadManagerName**: указывает имя конфигурации и диспетчер загрузки модулей.
* **RebootNodeIfNeeded**: для применения некоторых изменений в конфигурации на целевом узле может потребоваться его перезапуск. Если это свойство имеет значение **True**, узел перезапустится, как только конфигурация будет полностью применена, без дополнительного оповещения. Если это свойство имеет значение **False** (используется по умолчанию), конфигурация применяется, но, чтобы изменения вступили в силу, необходимо будет перезапустить узел вручную.
* **RefreshFrequencyMins**: используется при настройке опрашивающего сервера. Представляет частоту (в минутах), с которой локальный диспетчер конфигураций подключается к опрашивающему серверу для загрузки текущей конфигурации. Это свойство может быть задано в сочетании со свойством ConfigurationModeFrequencyMins. Если свойство RefreshMode имеет значение PULL, целевой узел подключается к опрашивающему серверу с интервалом, заданным свойством RefreshFrequencyMins, и загружает текущую конфигурацию. Модуль обеспечения согласованности применяет последнюю конфигурацию, загруженную на целевой узел, с интервалом, заданным свойством ConfigurationModeFrequencyMins. Если значение свойства RefreshFrequencyMins не выражено целым числом, кратным значению свойства ConfigurationModeFrequencyMins, система его округлит. По умолчанию используется значение 30.
* **RefreshMode**: возможные значения — **Push** (по умолчанию) и **Pull**. Если выбрана конфигурация push, файл конфигурации необходимо разместить на каждом целевом узле, используя любой клиентский компьютер. В режиме pull необходимо настроить опрашивающий сервер для локального диспетчера конфигураций для подключения и доступа к файлам конфигураций.

### Примеры обновления настроек локального диспетчера конфигураций

Настройки локального диспетчера конфигураций на целевом узле можно обновить, включив блок **LocalConfigurationManager** в блоке узла в сценарий конфигурации, как показано в следующем примере.

```powershell
Configuration ExampleConfig
{
    Node “Server001”
    {
        LocalConfigurationManager
        {
            ConfigurationID = "646e48cb-3082-4a12-9fd9-f71b9a562d4e"
            ConfigurationModeFrequencyMins = 45
            ConfigurationMode = "ApplyAndAutocorrect"
            RefreshMode = "Pull"
            RefreshFrequencyMins = 90
            DownloadManagerName = "WebDownloadManager"
            DownloadManagerCustomData = (@{ServerUrl="https://$PullServer/psdscpullserver.svc"})
            CertificateID = "71AA68562316FE3F73536F1096B85D66289ED60E"
            Credential = $cred
            RebootNodeIfNeeded = $true
            AllowModuleOverwrite = $false
        }
# One or more resource blocks can be added here
    }
}

# The following line invokes the configuration and creates a file called Server001.meta.mof at the specified path
ExampleConfig -OutputPath "c:\users\public\dsc"  
```

При выполнении сценария из предыдущего примера создается MOF-файл с желаемыми настройками. Для применения настроек используйте командлет **Set-DscLocalConfigurationManager**, как показано в следующем примере.

```powershell
Set-DscLocalConfigurationManager -Path "c:\users\public\dsc"
```

> **Примечание**. Для параметра **Path** необходимо указать тот же путь, который был указан для параметра **OutputPath** при вызове конфигурации в предыдущем примере.

Для просмотра текущих настроек локального диспетчера конфигураций можно использовать командлет **Get-DscLocalConfigurationManager**. Если вызвать этот командлет без параметров, он по умолчанию получит настройки локального диспетчера конфигураций для узла, на котором был выполнен. Чтобы указать другой узел, задайте в этом командлете параметр **CimSession**.<!--HONumber=Feb16_HO4-->
